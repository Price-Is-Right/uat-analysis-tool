{% extends "base.html" %}

{% block title %}UAT Created - Issue Tracker{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card shadow {% if ado_success %}border-success{% else %}border-warning{% endif %}">
            <div class="card-header {% if ado_success %}bg-success{% else %}bg-warning{% endif %} text-white">
                <h2 class="card-title mb-0">
                    {% if ado_success %}
                    <i class="fas fa-check-circle me-2"></i>UAT Ticket Created Successfully!
                    {% else %}
                    <i class="fas fa-exclamation-triangle me-2"></i>UAT Submission Issue
                    {% endif %}
                </h2>
            </div>
            <div class="card-body text-center">
                <div class="alert {% if ado_success %}alert-success{% else %}alert-danger{% endif %}" role="alert">
                    <h4 class="alert-heading">
                        {% if ado_success %}
                        <i class="fas fa-check-circle me-2"></i>Ticket Submitted
                        {% else %}
                        <i class="fas fa-exclamation-circle me-2"></i>Submission Failed
                        {% endif %}
                    </h4>
                    <p class="mb-0">
                        {% if ado_success %}
                        UAT request has been submitted for review.
                        {% else %}
                        Unable to create UAT work item in Azure DevOps. Please try again or contact support if the issue persists.
                        {% endif %}
                    </p>
                </div>

                {% if ado_success %}
                <div class="row">
                    <div class="col-md-12">
                        <div class="card bg-success bg-opacity-10 mb-3">
                            <div class="card-body">
                                <h5 class="card-title text-success">
                                    <i class="fab fa-microsoft me-2"></i>Azure DevOps Work Item
                                </h5>
                                <p><strong>Work Item ID:</strong> <a href="{{ work_item_url }}" target="_blank" class="text-decoration-none">#{{ work_item_id }}</a></p>
                                <p><strong>Title:</strong> {{ work_item_title }}</p>
                                <p><strong>Created:</strong> {{ current_datetime }}</p>
                                <p><strong>State:</strong> <span class="badge bg-success">{{ work_item_state }}</span></p>
                                <p><strong>Assigned To:</strong> {{ assigned_to }}</p>
                                <p class="mb-0"><strong>Type:</strong> Action</p>
                            </div>
                        </div>
                    </div>
                </div>
                {% else %}
                <div class="card bg-danger bg-opacity-10 mb-3 border-danger">
                    <div class="card-body">
                        <h5 class="card-title text-danger">
                            <i class="fas fa-exclamation-circle me-2"></i>Azure DevOps Error
                        </h5>
                        <p class="mb-2"><strong>Work item creation failed:</strong></p>
                        <p class="text-muted mb-0"><small>{{ ado_error }}</small></p>
                    </div>
                </div>
                {% endif %}

                {% if ado_success %}
                <div class="row">
                    <div class="col-md-12">
                        <div class="card bg-info bg-opacity-10 mb-3">
                            <div class="card-body">
                                <h5 class="card-title text-info">
                                    <i class="fas fa-cogs me-2"></i>Custom Field Configuration
                                </h5>
                                <div class="row">
                                    <div class="col-md-6">
                                        <p><strong>Assigned To:</strong> ACR Accelerate Blockers Help</p>
                                        <p><strong>Corp Assignment:</strong> <span class="badge bg-success">Active</span></p>
                                        <p><strong>Status Update:</strong> WizardAuto</p>
                                    </div>
                                    <div class="col-md-6">
                                        {% if opportunity_id %}
                                        <p><strong>Opportunity ID:</strong> {{ opportunity_id }}</p>
                                        {% endif %}
                                        {% if milestone_id %}
                                        <p><strong>Milestone ID:</strong> {{ milestone_id }}</p>
                                        {% endif %}
                                        <p><strong>Source:</strong> Enhanced Issue Tracker</p>
                                    </div>
                                </div>
                                <hr>
                                <h6><i class="fas fa-star me-2"></i>Referenced Features</h6>
                                {% if selected_features and selected_features|length > 0 %}
                                <ul class="mb-2">
                                    {% for feature in selected_features %}
                                    <li><strong>{{ feature.get('title', 'Unknown') }}</strong> (ID: {{ feature.get('id', 'N/A') }})</li>
                                    {% endfor %}
                                </ul>
                                {% else %}
                                <p class="text-muted mb-2">None</p>
                                {% endif %}
                                <h6><i class="fas fa-link me-2"></i>Referenced UATs</h6>
                                {% if selected_uats and selected_uats|length > 0 %}
                                <ul class="mb-0">
                                    {% for uat_id in selected_uats %}
                                    <li>UAT #{{ uat_id }}</li>
                                    {% endfor %}
                                </ul>
                                {% else %}
                                <p class="text-muted mb-0">None</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}

                {% if ado_success %}
                <div class="row">
                    <div class="col-md-12">
                        <div class="card bg-light mb-3">
                            <div class="card-body">
                                <h5 class="card-title">
                                    <i class="fas fa-clock me-2"></i>What's Next?
                                </h5>
                                <ul class="text-start mb-0">
                                    <li>Technical Review - Next Business Day</li>
                                    <li>Assigned Team review 3-5 Business Days</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="alert alert-info" role="alert">
                    <h6 class="alert-heading">
                        <i class="fas fa-envelope me-2"></i>Keep This Information
                    </h6>
                    <p class="mb-0">
                        Please refer to this UAT number for updates.
                    </p>
                </div>
                {% else %}
                <div class="alert alert-danger" role="alert">
                    <h6 class="alert-heading">
                        <i class="fas fa-life-ring me-2"></i>Need Help?
                    </h6>
                    <p class="mb-0">
                        If you continue to experience issues, please contact the support team or try submitting your request again.
                    </p>
                </div>
                {% endif %}

                <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                    <a href="{{ url_for('index') }}" class="btn btn-primary">
                        <i class="fas fa-plus me-1"></i>Submit Another Issue
                    </a>
                    <button type="button" class="btn btn-outline-secondary" onclick="window.print()">
                        <i class="fas fa-print me-1"></i>Print Confirmation
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Auto-clear local storage draft since issue was submitted
localStorage.removeItem('issue_draft');

{% if ado_success %}
// Optional: Add confetti or celebration animation (only on success)
document.addEventListener('DOMContentLoaded', function() {
    // Simple celebration animation
    const card = document.querySelector('.card.border-success');
    if (card) {
        card.style.transform = 'scale(0.95)';
        card.style.transition = 'transform 0.3s ease';
        setTimeout(() => {
            card.style.transform = 'scale(1)';
        }, 100);
    }
});
{% endif %}
</script>
{% endblock %}
