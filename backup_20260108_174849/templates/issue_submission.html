{% extends "base.html" %}

{% block title %}Issue Submission{% endblock %}

<!-- Override navbar to remove Home/Admin links during submission flow -->
{% block navbar %}
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
        <span class="navbar-brand">
            <i class="fas fa-headset me-2"></i>Issue Tracker System
        </span>
        <div class="navbar-nav ms-auto">
            <span class="nav-link text-light">
                <i class="fas fa-edit me-1"></i>Step 1: Issue Submission
            </span>
        </div>
    </div>
</nav>
{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">
                        <i class="fas fa-clipboard-list me-2"></i>Issue Submission - Step 1 of 3
                    </h4>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Welcome!</strong> Please provide details about your issue or request. Our AI will analyze your submission to ensure we have enough information to help you effectively.
                    </div>

                    <form method="POST" action="{{ url_for('submit_issue') }}" class="needs-validation" id="issueSubmissionForm" novalidate>
                        <!-- Title Field -->
                        <div class="mb-4">
                            <label for="title" class="form-label">
                                <strong>Issue Title</strong> <span class="text-danger">*</span>
                            </label>
                            <input type="text" 
                                   class="form-control form-control-lg" 
                                   id="title" 
                                   name="title" 
                                   value="{{ title or '' }}"
                                   required
                                   maxlength="200"
                                   placeholder="Enter a concise, descriptive title for your issue or request...">
                            <div class="form-text">
                                <small><i class="fas fa-lightbulb me-1 text-warning"></i>Example: "Need Sentinel connector for Palo Alto Firewall" or "Unable to access Azure OpenAI in Europe"</small>
                            </div>
                            <div class="invalid-feedback">
                                Please provide a valid issue title.
                            </div>
                        </div>

                        <!-- Description and Customer Scenario Field -->
                        <div class="mb-4">
                            <label for="description" class="form-label">
                                <strong>Description and Customer Scenario</strong> <span class="text-danger">*</span>
                            </label>
                            <textarea class="form-control" 
                                      id="description" 
                                      name="description" 
                                      rows="10" 
                                      required
                                      maxlength="3000"
                                      placeholder="Provide a detailed description including:

• What is the issue or request?
• What are you trying to accomplish?
• How is the customer trying to use it (or how can't they use it)?
• What specific technologies, services, or products are involved?
• Any relevant technical details, error messages, or constraints?

Be as specific as possible to help our AI understand your needs...">{{ description or '' }}</textarea>
                            <div class="form-text">
                                <small><i class="fas fa-info-circle me-1"></i><strong>Include both:</strong> (1) A clear description of the situation, AND (2) How the customer is trying to use it or what they can't do. Include technical details like Azure services, regions, compliance requirements, or specific product names.</small>
                            </div>
                            <div class="invalid-feedback">
                                Please provide a detailed description and customer scenario.
                            </div>
                        </div>

                        <!-- Business Impact Field (Optional) -->
                        <div class="mb-4">
                            <label for="impact" class="form-label">
                                <strong>Business Impact</strong> <span class="text-muted">(Optional but Recommended)</span>
                            </label>
                            <textarea class="form-control" 
                                      id="impact" 
                                      name="impact" 
                                      rows="4"
                                      maxlength="1000"
                                      placeholder="Describe the business impact:

• Who is affected and how many users?
• What are the consequences if not resolved?
• Urgency level and timeline requirements?
• Any compliance, security, or regulatory considerations?">{{ impact or '' }}</textarea>
                            <div class="form-text">
                                <small><i class="fas fa-chart-line me-1"></i>Help us prioritize: Describe urgency, business criticality, number of affected users, or compliance needs.</small>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg" id="submitBtn">
                                <i class="fas fa-check-circle me-2"></i>Check Quality & Continue
                            </button>
                            <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">
                                <i class="fas fa-times me-2"></i>Cancel
                            </a>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Help Section -->
            <div class="mt-4">
                <div class="card border-info">
                    <div class="card-header bg-light">
                        <h6 class="mb-0">
                            <i class="fas fa-question-circle me-2"></i>Need Help? See Examples
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="accordion" id="examplesAccordion">
                            <!-- Example 1 -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#example1">
                                        <i class="fas fa-plug me-2 text-primary"></i>Feature Request Example: Sentinel Connector
                                    </button>
                                </h2>
                                <div id="example1" class="accordion-collapse collapse" data-bs-parent="#examplesAccordion">
                                    <div class="accordion-body">
                                        <p class="mb-2"><strong>Title:</strong> Need Sentinel connector for Palo Alto Firewall</p>
                                        <p class="mb-2"><strong>Description and Scenario:</strong> We need a Microsoft Sentinel connector to integrate with Palo Alto Networks firewall logs. Our customer is a financial services company that needs to centralize their security monitoring in Sentinel. They have Palo Alto firewalls protecting their network perimeter and want to ingest firewall logs, threat data, and traffic analytics into Sentinel for SIEM analysis. Currently, they're manually exporting logs which is time-consuming and doesn't provide real-time threat detection.</p>
                                        <p class="mb-0"><strong>Business Impact:</strong> Affects 50+ enterprise customers. Without this connector, customers can't achieve real-time security monitoring for Palo Alto deployments. High priority for Q1 compliance requirements.</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Example 2 -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#example2">
                                        <i class="fas fa-database me-2 text-success"></i>Service Availability Example: Azure OpenAI
                                    </button>
                                </h2>
                                <div id="example2" class="accordion-collapse collapse" data-bs-parent="#examplesAccordion">
                                    <div class="accordion-body">
                                        <p class="mb-2"><strong>Title:</strong> Azure OpenAI service availability in West Europe</p>
                                        <p class="mb-2"><strong>Description and Scenario:</strong> We need to deploy Azure OpenAI GPT-4 models in the West Europe region for a customer service chatbot solution. The customer is a healthcare provider in Germany that requires data residency in the EU due to GDPR requirements. They want to build an AI-powered patient support chatbot that can answer common questions about appointments, prescriptions, and medical procedures. However, Azure OpenAI is not currently available in West Europe, and they cannot use other regions due to data sovereignty requirements.</p>
                                        <p class="mb-0"><strong>Business Impact:</strong> Blocking deployment for 3 major healthcare customers representing $2M ARR. Required for GDPR compliance. Project timeline at risk.</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Example 3 -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#example3">
                                        <i class="fas fa-shield-alt me-2 text-warning"></i>Compliance Example: GCC High Support
                                    </button>
                                </h2>
                                <div id="example3" class="accordion-collapse collapse" data-bs-parent="#examplesAccordion">
                                    <div class="accordion-body">
                                        <p class="mb-2"><strong>Title:</strong> Azure Databricks support in GCC High environment</p>
                                        <p class="mb-2"><strong>Description and Scenario:</strong> We have a US federal government customer that needs to run Azure Databricks workloads in the GCC High (Government Community Cloud High) environment. They are processing sensitive but unclassified information (SBU) for a defense logistics application. The customer needs to perform big data analytics and machine learning on supply chain data, but they can only use FedRAMP High authorized services in GCC High regions. Currently, Azure Databricks is not available in GCC High, forcing them to use less efficient alternatives.</p>
                                        <p class="mb-0"><strong>Business Impact:</strong> Critical for federal compliance. Blocking 5 government agencies. FedRAMP High authorization required. Contract value $5M.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Loading Overlay -->
<div id="loadingOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 9999; justify-content: center; align-items: center;">
    <div style="text-align: center; color: white;">
        <div class="spinner-border" role="status" style="width: 3rem; height: 3rem; margin-bottom: 1rem;">
            <span class="visually-hidden">Loading...</span>
        </div>
        <h4>Analyzing Input Quality...</h4>
        <p>Our AI is checking if we have enough information to help you</p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Bootstrap form validation
(function() {
    'use strict';
    window.addEventListener('load', function() {
        var forms = document.getElementsByClassName('needs-validation');
        var validation = Array.prototype.filter.call(forms, function(form) {
            form.addEventListener('submit', function(event) {
                if (form.checkValidity() === false) {
                    event.preventDefault();
                    event.stopPropagation();
                } else {
                    // Show loading overlay when form is valid and submitting
                    document.getElementById('loadingOverlay').style.display = 'flex';
                    document.getElementById('submitBtn').disabled = true;
                }
                form.classList.add('was-validated');
            }, false);
        });
    }, false);
})();
</script>
{% endblock %}
