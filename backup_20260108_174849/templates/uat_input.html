{% extends "base.html" %}

{% block title %}UAT Creation - Input Information{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-12 col-lg-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h2 class="card-title mb-0">
                        <i class="fas fa-ticket-alt me-2"></i>Create Unified Action Tracker (UAT)
                    </h2>
                </div>
                <div class="card-body">
                    <!-- Information Section -->
                    <div class="alert alert-info" role="alert">
                        <h5 class="alert-heading">
                            <i class="fas fa-info-circle me-2"></i>Help Us Help You Faster
                        </h5>
                        <p class="mb-2">
                            To provide you with the best assistance, we <strong>strongly recommend</strong> entering the following information:
                        </p>
                        <ul class="mb-0">
                            <li><strong>Opportunity ID</strong> - Links your request to a specific customer opportunity</li>
                            <li><strong>Milestone ID</strong> - Links you request to a specific customer milestone</li>
                        </ul>
                        <hr>
                        <p class="mb-0 text-muted small">
                            <i class="fas fa-lightbulb me-1"></i>
                            Providing these IDs helps our team prioritize your request and provide more targeted assistance.
                        </p>
                    </div>

                    <!-- Warning if navigating back from confirmation -->
                    {% if show_warning %}
                    <div class="alert alert-warning" role="alert">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Recommendation:</strong> Please enter Opportunity ID and Milestone ID for better support.
                    </div>
                    {% endif %}

                    <!-- Input Form -->
                    <form method="POST" action="{{ url_for('process_uat_input') }}" id="uatInputForm">
                        <div class="mb-4">
                            <label for="opportunity_id" class="form-label">
                                <i class="fas fa-briefcase me-2"></i>Opportunity ID
                                <span class="badge bg-success ms-1">Recommended</span>
                            </label>
                            <input type="text" 
                                   class="form-control form-control-lg" 
                                   id="opportunity_id" 
                                   name="opportunity_id" 
                                   placeholder="Enter Opportunity ID (e.g., OPP-12345)"
                                   value="{{ opportunity_id or '' }}">
                            <div class="form-text">
                                The unique identifier for the customer opportunity this request relates to
                            </div>
                        </div>

                        <div class="mb-4">
                            <label for="milestone_id" class="form-label">
                                <i class="fas fa-flag-checkered me-2"></i>Milestone ID
                                <span class="badge bg-success ms-1">Recommended</span>
                            </label>
                            <input type="text" 
                                   class="form-control form-control-lg" 
                                   id="milestone_id" 
                                   name="milestone_id" 
                                   placeholder="Enter Milestone ID (e.g., M-789)"
                                   value="{{ milestone_id or '' }}">
                            <div class="form-text">
                                Links you request to a specific customer milestone
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="d-grid gap-2 d-md-flex justify-content-md-between mt-4">
                            <a href="{{ url_for('no_match') }}" class="btn btn-outline-secondary btn-lg">
                                <i class="fas fa-arrow-left me-2"></i>Back to Results
                            </a>
                            <div>
                                <button type="submit" name="action" value="skip" class="btn btn-outline-warning btn-lg me-2">
                                    <i class="fas fa-forward me-2"></i>Continue Without IDs
                                </button>
                                <button type="submit" name="action" value="continue" class="btn btn-primary btn-lg">
                                    <i class="fas fa-check-circle me-2"></i>Continue with IDs
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Confirmation Modal for Skipping IDs -->
<div class="modal fade" id="skipConfirmModal" tabindex="-1" aria-labelledby="skipConfirmModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-warning">
                <h5 class="modal-title" id="skipConfirmModalLabel">
                    <i class="fas fa-exclamation-triangle me-2"></i>Recommendation
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="mb-3">
                    <strong>We strongly recommend entering Opportunity ID and Milestone ID</strong> to help our team:
                </p>
                <ul class="mb-3">
                    <li>Prioritize your request appropriately</li>
                    <li>Understand the business context</li>
                    <li>Provide faster, more targeted assistance</li>
                    <li>Link your request to the right project tracking</li>
                </ul>
                <p class="text-muted mb-0">
                    Are you sure you want to continue without entering these IDs?
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-arrow-left me-2"></i>Go Back and Enter IDs
                </button>
                <button type="button" class="btn btn-warning" onclick="submitWithoutIds()">
                    <i class="fas fa-forward me-2"></i>Continue Without IDs
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Check if user is trying to skip without entering IDs
document.getElementById('uatInputForm').addEventListener('submit', function(e) {
    const action = e.submitter.value;
    const opportunityId = document.getElementById('opportunity_id').value.trim();
    const milestoneId = document.getElementById('milestone_id').value.trim();
    
    // If user clicks "Continue Without IDs" and both fields are empty, show confirmation
    if (action === 'skip' && !opportunityId && !milestoneId) {
        e.preventDefault();
        const modal = new bootstrap.Modal(document.getElementById('skipConfirmModal'));
        modal.show();
    }
});

function submitWithoutIds() {
    // Close modal and submit form
    const modal = bootstrap.Modal.getInstance(document.getElementById('skipConfirmModal'));
    modal.hide();
    
    // Create a hidden form to submit
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = '{{ url_for("process_uat_input") }}';
    
    const actionInput = document.createElement('input');
    actionInput.type = 'hidden';
    actionInput.name = 'action';
    actionInput.value = 'force_skip';
    form.appendChild(actionInput);
    
    document.body.appendChild(form);
    form.submit();
}
</script>
{% endblock %}
