{% extends "base.html" %}

{% block title %}Quick ICA Test Form{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">
                        <i class="fas fa-brain me-2"></i>Quick Intelligent Context Analysis (ICA) Test
                    </h4>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Quick ICA Testing:</strong> Enter your Title, Description, and Impact data below to immediately test the Intelligent Context Analysis capabilities. This form bypasses the wizard screens and goes directly to the ICA review.
                    </div>

                    <form method="POST" action="{{ url_for('quick_ica') }}" class="needs-validation" id="quickICAForm" novalidate>
                        <div class="mb-4">
                            <label for="title" class="form-label">
                                <strong>Issue Title</strong> <span class="text-danger">*</span>
                            </label>
                            <input type="text" 
                                   class="form-control form-control-lg" 
                                   id="title" 
                                   name="title" 
                                   required
                                   maxlength="200"
                                   placeholder="Enter a concise issue title...">
                            <div class="invalid-feedback">
                                Please provide a valid issue title.
                            </div>
                        </div>

                        <div class="mb-4">
                            <label for="description" class="form-label">
                                <strong>Issue Description</strong> <span class="text-danger">*</span>
                            </label>
                            <textarea class="form-control" 
                                      id="description" 
                                      name="description" 
                                      rows="8" 
                                      required
                                      maxlength="2000"
                                      placeholder="Provide detailed description of the issue, including any specific technologies, services, or requirements..."></textarea>
                            <div class="form-text">
                                <small>Include specific Azure services, regions, compliance requirements, or technical details to help the ICA system analyze your request.</small>
                            </div>
                            <div class="invalid-feedback">
                                Please provide a detailed issue description.
                            </div>
                        </div>

                        <div class="mb-4">
                            <label for="impact" class="form-label">
                                <strong>Business Impact</strong>
                            </label>
                            <textarea class="form-control" 
                                      id="impact" 
                                      name="impact" 
                                      rows="4"
                                      maxlength="1000"
                                      placeholder="Describe the business impact, urgency, compliance requirements, or priority level..."></textarea>
                            <div class="form-text">
                                <small>Optional but recommended: Describe urgency, business criticality, compliance needs, or timeline constraints.</small>
                            </div>
                        </div>

                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary btn-lg" id="submitBtn">
                                <i class="fas fa-brain me-2"></i>Run ICA Analysis
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Loading Overlay (outside form so it stays visible) -->
            <div id="loadingOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 9999; justify-content: center; align-items: center;">
                <div style="text-align: center; color: white;">
                    <div class="spinner-border" role="status" style="width: 3rem; height: 3rem; margin-bottom: 1rem;">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <h4>Analyzing with AI...</h4>
                    <p>This may take a few seconds</p>
                </div>
            </div>
            
            <script>
            document.addEventListener('DOMContentLoaded', function() {
                document.getElementById('quickICAForm').addEventListener('submit', function(e) {
                    // Show loading overlay
                    document.getElementById('loadingOverlay').style.display = 'flex';
                    // Disable submit button to prevent multiple clicks
                    document.getElementById('submitBtn').disabled = true;
                    // Let form submit normally - don't prevent default
                });
            });
            </script>
                </div>
            </div>

            <div class="mt-4">
                <div class="card border-info">
                    <div class="card-header bg-light">
                        <h6 class="mb-0">
                            <i class="fas fa-lightbulb me-2"></i>ICA Test Examples
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="text-primary">Capacity Request Example:</h6>
                                <p class="small text-muted">
                                    <strong>Title:</strong> Need additional Databricks capacity in East US<br>
                                    <strong>Description:</strong> Our team needs to increase our Azure Databricks cluster capacity from 100 to 500 cores in the East US region for our ML workload processing...<br>
                                    <strong>Impact:</strong> High priority - blocking production data pipeline deployment
                                </p>
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-success">Service Availability Example:</h6>
                                <p class="small text-muted">
                                    <strong>Title:</strong> Azure OpenAI service availability in Europe<br>
                                    <strong>Description:</strong> We need to deploy Azure OpenAI GPT-4 models in West Europe for our customer service chatbot solution due to data sovereignty requirements...<br>
                                    <strong>Impact:</strong> Medium priority - required for GDPR compliance
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Bootstrap form validation
(function() {
    'use strict';
    window.addEventListener('load', function() {
        var forms = document.getElementsByClassName('needs-validation');
        var validation = Array.prototype.filter.call(forms, function(form) {
            form.addEventListener('submit', function(event) {
                if (form.checkValidity() === false) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);
        });
    }, false);
})();

// Character counters
document.getElementById('title').addEventListener('input', function() {
    const maxLength = 200;
    const currentLength = this.value.length;
    const remaining = maxLength - currentLength;
    
    if (!document.getElementById('title-counter')) {
        const counter = document.createElement('div');
        counter.id = 'title-counter';
        counter.className = 'form-text text-end small';
        this.parentNode.appendChild(counter);
    }
    
    const counter = document.getElementById('title-counter');
    counter.textContent = `${currentLength}/${maxLength} characters`;
    counter.className = remaining < 20 ? 'form-text text-end small text-warning' : 'form-text text-end small text-muted';
});

document.getElementById('description').addEventListener('input', function() {
    const maxLength = 2000;
    const currentLength = this.value.length;
    const remaining = maxLength - currentLength;
    
    if (!document.getElementById('description-counter')) {
        const counter = document.createElement('div');
        counter.id = 'description-counter';
        counter.className = 'form-text text-end small';
        this.parentNode.appendChild(counter);
    }
    
    const counter = document.getElementById('description-counter');
    counter.textContent = `${currentLength}/${maxLength} characters`;
    counter.className = remaining < 200 ? 'form-text text-end small text-warning' : 'form-text text-end small text-muted';
});
</script>
{% endblock %}